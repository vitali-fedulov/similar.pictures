<!-- Copyright: Vitali Fedulov (fedulov.vitali@gmail.com) 2015-2023 -->
<!DOCTYPE html>
<html lang="en">
<head>
 
 
<script async src="//www.googletagmanager.com/gtag/js?id=G-2JHEHHKWBJ"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'G-2JHEHHKWBJ');
</script>

 <title>Duplicate image finder</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto">
 <link rel="icon" type="image/png" href="images/favicon.png">
 <link rel="stylesheet" type="text/css" href="css/clustering.css">
</head>


<body>

 


 <div class="flex-container-select-files">
 <div class="flex-center-horizontally">
 <div>
 <h1 class="text-centered clustering-title">Duplicate Image Finder</h1>
 </div>

 <div id="terms-of-service">
 <p class="terms-of-service-header text-centered">Terms of service and data protection</p>
 
 <div id="terms"></div>
 </div>

 <div>

 <p id="messages" class="hidden">Messages</p>

 <div id="ok-button" class="text-centered">
 <div class="button">OK</div>
 </div>

 <div id="file-selector" class="text-centered">
 <input class="hidden" type="file" id="filesSelected" webkitdirectory multiple accept="image/*" onchange="v48(this.files)" onclick="v16()">
 <a class="button">Select a folder with images</a>
 </div>


 <div class="fast-option">
 <input type="checkbox" id="fast-option" onclick="v11()">
 <div class="option-text">Option to accelerate the search (recommended). It has somewhat larger chance to mismatch pictures. The acceleration can be considerable for folders with many JPEG images.</div>
 </div>

 <div class="link-block text-centered">
 <a class="home-cancel-link" id="cancel-link" onclick="v42()">Cancel</a>
 <a class="home-cancel-link" href="/">Home</a>
 </div>

 </div>

 </div>
 
 </div> 
 
 

 


 <div class="fixed-top hidden">

 <div class="fixed-top-gray">
 <a href = "index.html" class="logo-href"><span class="logo">Duplicate Image Finder</a>
 <div class="button button-new-search">New clustering</div>
 </div>

 <div class="fixed-white-1">
 <div class="progress">
 <div id="progress-bar"></div>
 </div>
 <div class="progress-text"></div>
 </div>

 <div class="fixed-white-2 hidden">
 <span class="found-clusters"></span> <span> (</span><span class="view-list">show/hide as list</span><span>)</span>
 <textarea class="textarea"></textarea>
 <p class="explanation">
 <small class="small">Scroll down to view all clusters. Keep the browser tab open to avoid stopping the clustering process.</small>
 </p>
 </div>

 </div>
 
 <div id="clusters" class="clusters"></div>
 

<script>

function load(url, element) {
 fetch(url)
 .then(response => response.text())
 .then(data => {
 element.innerHTML = data;
 })
 .catch(error => {
 console.error('Error:', error);
 });
}
window.addEventListener('DOMContentLoaded', () => {
 v9();
 load("tos_en.html", document.querySelector("#terms"));
 document.querySelector("#ok-button").style.display = 'none';
 document.querySelector("#cancel-link").style.display = 'none';
 document.querySelector(".button-new-search").addEventListener('click', (e) => {
 v54();
 });
 document.querySelector("#ok-button").addEventListener('click', (e) => {
 v54();
 });
 window.scrollTo({top: 0});
});

var v77 = {

 v94 : 24, v80 : 2,
 v35 : 12,
 v49 : 80000, v7 : 40*1024*1024, v73 : 0, v56 : 0,
 v13 : false,

 v93 : 0, v68 : 0,

 v100 : [],
 v45 : [], v10 : [],
 v75 : [], v79 : [],
 v81 : [],
 v50 : 0,
 v19 : [],
 v128 : 10, v110 : 100, v34 : 50, v69 : 0.2, v63 : 2, v65 : 0.7,
 v40 : [], v26 : /(^image\/gif$)|(^image\/jpeg$)|(^image\/jpg$)|(^image\/bmp$)|(^image\/png$)|(^image\/webp$)/,
 v76 : "",

 v106 : null,
 v51 : 0,

 v28 : false,

 v1 : 1000,
 v0 : null,
 v15 : "image/jpeg", v8 : 0.6,
 v37 : 160, v32 : '\n',
 v20 : '\n\n',
 v21 : 0,
 v12 : false,
 v6 : 0,
};

var v82 = {
 v31 : v77.v35 * v77.v35,
 v115 : v77.v94 * v77.v35, v86 : v77.v94 * v77.v94,
};



function v11() {
 localStorage.setItem("fast-option", document.querySelector("#fast-option").checked);
 return;
}

function v9() {
 if (localStorage.getItem("fast-option") == null) {
 document.querySelector("#fast-option").checked = true;
 return;
 }
 if (localStorage.getItem("fast-option") == 'false') {
 document.querySelector("#fast-option").checked = false;
 } else {
 document.querySelector("#fast-option").checked = true;
 }
 return;
}

function v42() {
 v54();
}


function v54() {
 location.reload();
 window.scrollTo({top: 0});
}


document.getElementById('file-selector').addEventListener('click', v27);


function v27() {
 var v105 = document.getElementById('filesSelected');
 if (!!v105.webkitdirectory == false) {
 alert('This browser does not support folder selection. Please try latest desktop Chrome, Firefox or Edge.');
 return;
 }
 v105.click();
}


function v39(v95, v103, v112, v83) {
 v95.readAsArrayBuffer(v112.slice(0, v77.v49));
 v95.onload = function (v108) {
 var v104 = new Uint8Array(v108.target.result),
 v99, v127;
 var v122 = v104.length;
 var v150 = 0;
 for (v150 = 2; v150 < v122; v150++) {
 if (v104[v150] == 0xFF) {
 if (!v99) {
 if (v104[v150 + 1] == 0xD8) {
 v99 = v150;
 }
 } else {
 if (v104[v150 + 1] == 0xD9) {
 v127 = v150 + 2; break;
 }
 }
 }
 }
 if (v99 && v127) {
 v83(new Blob([v104.subarray(v99, v127)], {type:"image/jpeg"}));
 } else {
 v83(null);
 }
 };

 v95.onerror = function() {
 v83(null);
 };
}


function v23(v98) {

 if (v77.v21 < 2) {
 document.querySelector(".fixed-top").style.display = 'none';
 document.querySelector(".flex-container-select-files").style.display = 'block';
 document.querySelector("#messages").textContent = "The selected folder has less than 2 images of supported types. There is nothing to compare. Please select a different folder.";
 document.querySelector("#messages").style.display = 'block';
 document.querySelector("#file-selector").style.display = 'none';
 document.querySelector("#cancel-link").style.display = 'none';
 document.querySelector("#ok-button").style.display = 'block';
 return;
 }
 document.querySelector(".progress").parentNode.removeChild( document.querySelector(".progress"));
 var v139 = "s";
 if (v98 + 1 == 1) {
 v139 = "";
 }

 v14(".progress-text", "Successfully scanned ".concat(v77.v106.length, " file", v139, "."));
 if (v77.v50 == 0) {
 v14(".progress-text", "Zero similar images found from the successfully scanned ".concat(v77.v106.length, " file", v139, "."));
 }

 return;
}


function v67() {
 var v66 = 0;
 var v141 = 0, v145 = 0, v130 = 0, v130 = 0;
 for (v141 = 1; v141 < v77.v94 - 1; v141+= v77.v80) {
 for (v145 = 1; v145 < v77.v94 - 1; v145+= v77.v80) {
 var v17 = [];
 for (v130 = -1; v130 < 2; v130++) {
 for (v135 = -1; v135 < 2; v135++) {
 v17.push((v145 + v135) * v77.v94 + v141 + v130);
 }}
 v77.v100[v66] = v17;
 v66++;
 }}
 v77.v84 = v17.length;
 v77.v93 = v66;
 v77.v68 = 1 / v66;

 v82.v70 = v77.v93 * v77.v34 * v77.v34 * v77.v69;
 v82.v64 = v82.v70 * v77.v63;

 return;
}

v67();

function v4(v103, v74) {

 var v92 = [];
 var v60 = v77.v19[v103];
 var v62 = v77.v19[v74];

 if (typeof v60 === "undefined" && typeof v62 === "undefined") {
 v77.v19[v103] = v77.v50;
 v77.v19[v74] = v77.v50;
 v77.v81.push([v103, v74]);
 v77.v50++;
 v5(v77.v50 - 1);
 v18(v77.v50 - 1, v103);
 v18(v77.v50 - 1, v74);
 return;
 }

 if (typeof v60 === "number" && typeof v62 === "undefined") {
 v92 = v77.v81[v60];
 v92.push(v74);
 v77.v19[v74] = v60;
 v77.v81[v60] = v92;
 v18(v60, v74);
 return;
 }

 if (typeof v60 === "undefined" && typeof v62 === "number") {
 v92 = v77.v81[v62];
 v92.push(v103);
 v77.v19[v103] = v62;
 v77.v81[v62] = v92;
 v18(v62, v103);
 return;
 }

}

function v61(v74) {

 var v133 = 0, v137 = 0;
 var v136 = 0, v129 = 0, v134 = 0, v131 = 0;
 var v116 = 0, v78 = 0, v103 = 0;
 var v38 = [[], [], []];
 var v36 = v77.v45[v74];
 v77.v10[v74] = v36;
 var v103 = 0;

 for (v103 = v74 - 1; v103 >= 0; v103--) {

 v136 = v77.v75[v103], v129 = v77.v79[v103];
 v134 = v77.v75[v74], v131 = v77.v79[v74];
 if (v136 * v131 * v77.v110 + v77.v128 * v136 * v134 < v134 * v129* v77.v110 ||
 v136 * v131 * v77.v110 > v134 * v129 * v77.v110 + v77.v128 * v136 * v134) {
 continue;
 }

 v38 = v77.v10[v103];

 v116 = 0;
 for (v78 = 0; v78 < v77.v93; v78++) {
 v133 = v38[0][v78];
 v137 = v36[0][v78];
 v116 += (v133 - v137) * (v133 - v137);
 }
 if (v116 > v82.v70) {
 continue;
 }

 v116 = 0;
 for (v78 = 0; v78 < v77.v93; v78++) {
 v133 = v38[1][v78];
 v137 = v36[1][v78];
 v116 += (v133 - v137) * (v133 - v137);
 }
 if (v116 > v82.v64) {
 continue;
 }


 v116 = 0;
 for (v78 = 0; v78 < v77.v93; v78++) {
 v133 = v38[2][v78];
 v137 = v36[2][v78];
 v116 += (v133 - v137) * (v133 - v137);
 }
 if (v116 > v82.v64) {
 continue;
 }

 v4(v103, v74);
 v2();

 }
 return;
}


function v14(v22, v111) {
 document.querySelector(v22).textContent = v111;
}

function v2() {
 var v139 = "s";
 if (v77.v50 == 1) {
 v139 = "";
 }
 v14(".found-clusters", "Found ".concat(v77.v50, ' cluster', v139));
}


var v46 = document.querySelector("#progress-bar");

function v3(v98) {
 if (v98 + 1 == v77.v51) {
 return;
 }
 v14(".progress-text", "Please wait... Reading ".concat(v98, ' from ', v77.v51, ' selected files.'));
 var v87 = ~~(100 * (v98 + 1) / v77.v51);
 if (v87 < 5) {
 v87 = 5;
 }
 v46.style.width = "".concat(v87, "%");
}
function v88(v43, v33) {
 var v114 = document.createElement("div");
 v114.className = v43;
 v33.appendChild(v114);
 return v114;
}

var v44 = document.getElementById("clusters");

function v5(v71) {
 var v53 = v88("cluster", v44);
 var v72 = v88("cluster-num", v53);
 v72.textContent = v71 + 1;
 var v25 = v88("cluster-content", v53);
 v88("cluster-imgs", v25);
 v88("cluster-paths", v25);
}


function v18(v71, v103) {
 var v85 = document.querySelectorAll( ".cluster-imgs" )[v71];
 var v91 = v88("cluster-img-div", v85);
 var v123 = new Image();
 v123.classList.add("cluster-img");
 v91.appendChild(v123);
 var v58 = v88("image-size", v91);
 var v24 = document.querySelectorAll( ".cluster-paths" )[v71];
 var v52 = v88("img-path", v24);
 var v112 = v77.v106[v77.v40[v103]];
 v52.textContent = v112.webkitRelativePath;
 v29(v112, v123, v58);
}

function v29(v112, v123, v58) {
 var v95 = new FileReader(); v95.v112 = v112;
 v95.onload = function() {
 return function(e) {
 var v41 = new Image();
 v41.src = e.target.result;
 var v97 = document.createElement("canvas");
 var v124 = v97.getContext("2d", { willReadFrequently: true });
 v41.onload = function() {
 v58.textContent = "".concat(v41.width, "×", v41.height);
 if (v41.width >= v41.height) {
 v97.height = v77.v37 * 2; v97.width = ~~(v41.width * v97.height / v41.height);
 } else {
 v97.width = v77.v37 * 2;
 v97.height = ~~(v41.height * v97.width / v41.width);
 }
 v123.width = v97.width / 2; v123.height = v97.height / 2;
 v124.drawImage(v41, 0, 0, v97.width, v97.height);
 v123.src = v97.toDataURL(v77.v15, v77.v8);
 v97 = null; v124 = null;
 v41 = null;
 v95 = null;
 v77.v6++;
 };
 };
 } ();
 v95.readAsDataURL(v112);
}

function v59() {
 var v117 = "";
 var v143 = 0;
 var v150 = 0;
 for (v143 = 0; v143 < v77.v50; v143++) {
 var v55 = v77.v81[v143];
 for (v150 = 0; v150 < v55.length - 1; v150++) {
 v117 = v117.concat(v77.v106[v77.v40[v55[v150]]].webkitRelativePath, v77.v32);
 }
 v117 = v117.concat(v77.v106[v77.v40[v55[v150]]].webkitRelativePath, v77.v20);
 }
 v117 = v117.slice(0, -2);
 document.querySelector(".textarea").value = v117;
 document.querySelector(".textarea").classList.toggle("textareaon");
}


function v16() {
 document.querySelector("#terms-of-service").style.display = 'none';
 v77.v0 = setTimeout(function() {
 document.querySelector("#messages").textContent = 'Please wait if you selected a very large number of images: it may take tens of seconds before the clustering starts.';
 document.querySelector("#messages").style.display = 'block';
 document.querySelector("#file-selector").style.display = 'none';
 document.querySelector(".fast-option").style.display = 'none';
 document.querySelector("#cancel-link").style.display = 'block';
 }, v77.v1);
}


function v118(v90, v150, v149, v121) {
 return [v90[v149 * (v121 * 4) + (v150 * 4)],
 v90[v149 * (v121 * 4) + (v150 * 4) + 1],
 v90[v149 * (v121 * 4) + (v150 * 4) + 2]];
 }
function v47(v90) {

 var v107 = [[], [], []];
 var v150 = 0, v149 = 0, v142 = 0, v138 = 0;
 var v144 = 0, v140 = 0, v151 = 0;
 var v102 = 0, v101 = 0, v109 = 0; var v139 = 0;
 var v89 = [];
 var v132 = 0, v146 = 0, v148 = 0;
 
 for (v132 = 0; v132 < v77.v93; v132++) {
 v102 = 0, v101 = 0, v109 = 0;
 v139 = 0;
 for (v146 = 0; v146 < v77.v84; v146++ ) {
 v150 = ~~(v77.v100[v132][v146] / v77.v94);
 v149 = v77.v100[v132][v146] % v77.v94;
 for (v148 = 0; v148 < v82.v31; v148++) {
 v142 = ~~(v148 / v77.v35);
 v138 = v148 % v77.v35;
 v89 = v118(v90, v150 * v77.v35 + v142,
 v149 * v77.v35 + v138, v82.v115);
 v144 = v89[0];
 v140 = v89[1];
 v151 = v89[2];

 v102 += 0.299000 * v144 + 0.587000 * v140 + 0.114000 * v151;
 v101 += 128 - 0.168736 * v144 - 0.331264 * v140 + 0.500000 * v151;
 v109 += 128 + 0.500000 * v144 - 0.418688 * v140 - 0.081312 * v151;
 v139++;

 }
 
 }
 v107[0][v132] = v102 / v139; v107[1][v132] = v101 / v139;
 v107[2][v132] = v109 / v139;
 }
 return [v57(v107[0]), v57(v107[1]), v57(v107[2])];
}



function v57(v126) {
 var v96 = [];
 var v147 = v126.length;
 var v120 = 0; var v113 = Number.POSITIVE_INFINITY;
 var v138 = 0;
 for (v138 = 0; v138 < v147; v138++) {
 if (v126[v138] > v120) {
 v120 = v126[v138];
 } else if (v126[v138] < v113) {
 v113 = v126[v138];
 }
 }
 var v125 = v120 - v113;
 for (v138 = 0; v138 < v147; v138++) {
 v96[v138] = (v126[v138] - v113) * 255 / v125;
 }
 return v96;
}

function v48(v106) {
 v77.v13 = document.querySelector("#fast-option").checked;
 v77.v6 = 0;
 clearTimeout(v77.v0);
 document.querySelector("#file-selector").style.display = 'none';
 v77.v106 = v106;
 v77.v76 = v106[0].webkitRelativePath.split("/")[0];
 v77.v51 = v106.length;
 var v98 = 0; var v103 = 0;
 var v95 = new FileReader();
 var v123 = new Image();
 var v97 = document.createElement("canvas");
 v97.width = v82.v115;
 v97.height = v82.v115;
 var v124 = v97.getContext("2d", { willReadFrequently: true });
 document.querySelector(".flex-container-select-files").style.display = 'none';
 document.querySelector(".fixed-top").style.display = 'block';
 document.querySelector(".view-list").addEventListener('click', (e) => {
 v59();
 });
 document.querySelector(".fixed-white-2").style.display = 'block';
 v2();
 v30(v98, v103, v95, v123, v124);
}

function v30(v98, v103, v95, v123, v124) {
 
 if (v98 >= v77.v51) {
 v23(v98);
 return;
 }
 
 if (!v77.v26.test(v77.v106[v98].type) || v77.v106[v98].size > v77.v7) {
 v98++;
 v30(v98, v103, v95, v123, v124);
 return;
 }



 if (v77.v13 &&
 v77.v106[v98].type == "image/jpeg" &&
 !v77.v28) {

 v39(v95, v103, v77.v106[v98], function(v119) {
 
 if (v119 == null) {
 v77.v28 = true;
 v30(v98, v103, v95, v123, v124);
 return;

 } else {
 
 v123.src = URL.createObjectURL(v119);

 v123.onload = function() {
 
 v77.v21++;
 if (v98 < 5 || v98 % 5 === 0) {
 v3(v98);
 }
 v124.drawImage(v123, 0, 0, v82.v115, v82.v115);
 v77.v45[v103] = v47(v124.getImageData(0, 0, v82.v115, v82.v115).data);
 v77.v75[v103] = v123.width;
 v77.v79[v103] = v123.height;

 v77.v40[v103] = v98;
 v77.v73 = v103 + 1;
 v77.v56 = v98 + 1;

 URL.revokeObjectURL(v123.src);
 v61(v103);
 v98++;
 v103++;
 if (!v77.v12) {
 v77.v12 = true;
 }
 v77.v28 = false;
 v30(v98, v103, v95, v123, v124);
 return;
 };

 v123.onerror = function() {
 URL.revokeObjectURL(v123.src); v77.v28 = true;
 v30(v98, v103, v95, v123, v124);
 return;
 };

 return;
 }
 });

 } else {
 v77.v28 = true;
 }

 if (v77.v28 == false) {
 return;
 }



 v95.readAsDataURL(v77.v106[v98]);
 
 v95.onerror = function() {
 v98++;
 v77.v28 = false;
 v30(v98, v103, v95, v123, v124);
 return;
 };

 v95.onload = function(evt) {
 v123.src = evt.target.result;
 
 v123.onerror = function() {
 v98++;
 v77.v28 = false;
 v30(v98, v103, v95, v123, v124);
 return;
 };
 
 v123.onload = function() {
 v77.v21++;
 if (v98 < 5 || v98 % 5 === 0) {
 v3(v98);
 }
 v124.drawImage(v123, 0, 0, v82.v115, v82.v115); v77.v45[v103] = v47(v124.getImageData(0, 0, v82.v115, v82.v115).data);
 v77.v75[v103] = v123.width;
 v77.v79[v103] = v123.height;

 v77.v40[v103] = v98;
 v77.v73 = v103 + 1;
 v77.v56 = v98 + 1;

 v61(v103);

 v98++;
 v103++;
 
 if (!v77.v12) {
 v77.v12 = true;
 }
 v77.v28 = false;
 v30(v98, v103, v95, v123, v124);
 return;
 };
 };
}

</script> 
</body>
</html>
